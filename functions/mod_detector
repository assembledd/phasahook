local utility = {path=nil,connections={}}
local httpservice = cloneref(game:GetService("HttpService"))
local players = cloneref(game:GetService("Players"))
local replicatedstorage = cloneref(game:GetService("ReplicatedStorage"))

function utility.isvalid(uid)
    local file = readfile(utility.path)
    return file:find(uid) ~= nil
end

function utility.call_functions()
    for i,v in utility.connections do v() end
end

function utility.addmod(uid)
    local file = readfile(utility.path)
    local parser = false
    if #file > 2 then
        parser = true
    end

    if not utility.isvalid(uid) then
        writefile(utility.path, (parser and file .. "," or "") .. uid)
        task.wait()
        utility.call_functions()
    end
end

function utility.ismod(uid)
    return utility.isvalid(uid)
end

function utility.add_connection(func)
    table.insert(utility.connections, func)
end

function utility.pd()
    return function(player)
        task.spawn(function()
            local rep = replicatedstorage:WaitForChild("Players"):WaitForChild(player.Name):WaitForChild("Status"):WaitForChild("GameplayVariables")
            rep:GetAttributeChangedSignal("GodMode"):Once(function()
                utility.addmod(player.UserId)
            end)
            rep:GetAttributeChangedSignal("Invisible"):Once(function()
                utility.addmod(player.UserId)
            end)
        end)
    end
end

function utility.init(directory)
    utility.path = directory
    local file = utility.path .. "/modlog.txt"
    if not isfile(file) then
        writefile(file,"")
    end
    utility.path = file
end

return utility
